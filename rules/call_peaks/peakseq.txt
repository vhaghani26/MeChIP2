rule bam_to_sam:
	input:
		"bam_files/{sample}.sorted.dedup.bam"
	output:
		"aligned_reads/{sample}.sorted.dedup.sam"
	shell:
		"samtools view -@ THREADS {input} > {output}"
		
rule preprocess_data:
	input:
		"aligned_reads/{sample}.sorted.dedup.sam"
	output:
		"peakseq_peaks/{sample}_preprocess"
	run:
		shell("mkdir -p {output}")
		shell("PeakSeq -preprocess SAM {input} {output}")
		
rule call_peak
	input:
		"peakseq_peaks/peakseq_config.txt"
	output:
		"peakseq_peaks/{sample}.narrowPeak"
	run:
		shell("PeakSeq -peak_select {input}")
		shell("mv beacon.log {wildcards.sample}.txt seed.txt peakseq_peaks/")
